sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../controls/MessageToastDeluxe","../model/formatter","sap/base/util/UriParameters"],function(e,t,i,r,l){"use strict";return e.extend("flush.game.controller.Game",{formatter:r,onInit:function(){e.prototype.onInit.apply(this,arguments);var i=new t({level:"",multi:false,instructions:"",difficulty:1,title:this.getResourceBundle().getText("gameTitleLoading"),busy:true,player1Energy:0,player2Energy:0,player1Lives:0,player2Lives:0,player1LivesArray:[],player2LivesArray:[]});this.setModel(i,"view");this.getRouter().getRoute("game").attachPatternMatched(this._loadLevel,this)},_loadLevel:function(e){var t=e.getParameter("arguments");this.getModel("view").setProperty("/busy",true);this.getModel("view").setProperty("/level",t.level);this.getModel("view").setProperty("/difficulty",parseInt(t.difficulty));this.getModel("view").setProperty("/multi",/multi/i.test(t.level));this.getModel("view").setProperty("/instructions",this.getResourceBundle().getText("gameInstructions"+t.level));if(t.level==="WhackABug"){this.getModel("view").setProperty("/timeLimit",45)}else if(t.level==="Uncontrollable"){this.getModel("view").setProperty("/timeLimit",60)}else if(t.level==="UncontrollableMultiplayer"){this.getModel("view").setProperty("/timeLimit",60)}else if(t.level==="PlopARobot"){this.getModel("view").setProperty("/timeLimit",30)}var i=new l(window.location.href);if(i.get("game-debug")){this.getModel("view").setProperty("/timeLimit",999999);this.getModel("view").setProperty("/debug",true)}this.getModel("view").setProperty("/title",this.getResourceBundle().getText("gameTitleLevel",[this.getModel("view").getProperty("/level"),this.getModel("view").getProperty("/difficulty")]));this.byId("page").invalidate();this._playStory(this.getModel("view").getProperty("/level"));this.getSoundManager().stop("Level");this.getSoundManager().play("Level")},_updateLifeBar:function(e){var t=this.getModel("view").getProperty("/player"+e+"Lives");var i=[];for(var r=0;r<t;r++){i.push(1)}this.getModel("view").setProperty("/player"+e+"LivesArray",i)},onLevelInit:function(){this.getModel("view").setProperty("/busy",false);this._updateLifeBar(1);this._updateLifeBar(2);this.getSoundManager().play("roboStart")},onLevelEnd:function(e){clearInterval(this._iInterval);this.getModel("view").setProperty("/instructions","");if(this.getModel("view").getProperty("/multi")){this.getRouter().getTargets().display("multi",{who:e.getParameter("who"),level:this.getModel("view").getProperty("/level"),difficulty:this.getModel("view").getProperty("/difficulty")});this.getRouter().navTo("multi",undefined,true)}else{this.getRouter().navTo("home")}},onLevelHit:function(e){var t=e.getParameter("who");this._updateLifeBar(t)},onLevelBomb:function(e){var t=e.getParameter("who")},onBack:function(){clearInterval(this._iInterval);this._stopStory();this.byId("page").end().then(function(){if(this.getModel("view").getProperty("/multi")){this.getRouter().navTo("multi")}else{this.getRouter().navTo("home")}}.bind(this))}})});